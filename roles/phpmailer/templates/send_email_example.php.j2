<?php
/**
 * PHPMailer Usage Examples for Azure Communication Services
 * 
 * This file demonstrates various ways to send emails using PHPMailer
 * with Azure Communication Services SMTP relay.
 * 
 * WARNING: This is an example file. Remove or secure it in production!
 * 
 * Generated by Ansible
 */

// Include the mailer configuration
require_once '{{ phpmailer_install_dir }}/mailer_config.php';

$page_title = "PHPMailer Usage Examples";
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php echo $page_title; ?></title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .content {
            padding: 40px;
        }
        .example {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 25px;
            margin: 25px 0;
            border-radius: 5px;
        }
        .example h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        .example p {
            margin-bottom: 15px;
            color: #555;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        .keyword { color: #ff79c6; }
        .string { color: #50fa7b; }
        .comment { color: #6272a4; font-style: italic; }
        .function { color: #8be9fd; }
        .variable { color: #f1fa8c; }
        .info-box {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .info-box h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        .warning-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .warning-box strong {
            color: #856404;
        }
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        .btn:hover {
            background: #5568d3;
        }
        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            border-top: 1px solid #dee2e6;
        }
        ul {
            margin-left: 20px;
            margin-top: 10px;
        }
        li {
            margin: 8px 0;
        }
        .code-inline {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö PHPMailer Usage Examples</h1>
            <p>Azure Communication Services Integration</p>
        </div>
        
        <div class="content">
            <div class="warning-box">
                <strong>‚ö†Ô∏è Important:</strong> This is an example/documentation page. Remove or secure it in production environments!
            </div>
            
            <div class="info-box">
                <h4>üìã Configuration Location</h4>
                <p>All email configuration is stored in: <span class="code-inline">{{ phpmailer_install_dir }}/mailer_config.php</span></p>
                <p>This file contains helper functions and Azure SMTP settings.</p>
            </div>

            <!-- Example 1: Simple Email -->
            <div class="example">
                <h3>1Ô∏è‚É£ Sending a Simple Email</h3>
                <p>The easiest way to send an email using the pre-configured helper function:</p>
                <pre><span class="comment">// Include the configuration</span>
<span class="keyword">require_once</span> <span class="string">'{{ phpmailer_install_dir }}/mailer_config.php'</span>;

<span class="comment">// Send a simple email</span>
<span class="variable">$to</span> = <span class="string">'recipient@example.com'</span>;
<span class="variable">$subject</span> = <span class="string">'Hello from PHPMailer'</span>;
<span class="variable">$body</span> = <span class="string">'<h1>Hello!</h1><p>This is a test email.</p>'</span>;
<span class="variable">$altBody</span> = <span class="string">'Hello! This is a test email.'</span>; <span class="comment">// Plain text version</span>

<span class="keyword">if</span> (<span class="function">sendEmail</span>(<span class="variable">$to</span>, <span class="variable">$subject</span>, <span class="variable">$body</span>, <span class="variable">$altBody</span>)) {
    <span class="keyword">echo</span> <span class="string">"Email sent successfully!"</span>;
} <span class="keyword">else</span> {
    <span class="keyword">echo</span> <span class="string">"Failed to send email."</span>;
}</pre>
            </div>

            <!-- Example 2: HTML Email -->
            <div class="example">
                <h3>2Ô∏è‚É£ Sending HTML Email with Styling</h3>
                <p>Send a beautifully formatted HTML email:</p>
                <pre><span class="keyword">require_once</span> <span class="string">'{{ phpmailer_install_dir }}/mailer_config.php'</span>;

<span class="variable">$to</span> = <span class="string">'user@example.com'</span>;
<span class="variable">$subject</span> = <span class="string">'Welcome to Our Service!'</span>;

<span class="variable">$body</span> = <span class="string">'
<html>
<head>
    <style>
        body { font-family: Arial, sans-serif; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: #667eea; color: white; padding: 20px; text-align: center; }
        .content { padding: 20px; background: #f9f9f9; }
        .button { 
            display: inline-block; 
            padding: 12px 30px; 
            background: #667eea; 
            color: white; 
            text-decoration: none; 
            border-radius: 5px; 
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Welcome!</h1>
        </div>
        <div class="content">
            <h2>Thank you for joining us</h2>
            <p>We are excited to have you on board.</p>
            <p><a href="https://example.com" class="button">Get Started</a></p>
        </div>
    </div>
</body>
</html>'</span>;

<span class="variable">$altBody</span> = <span class="string">'Welcome! Thank you for joining us. Visit https://example.com to get started.'</span>;

<span class="function">sendEmail</span>(<span class="variable">$to</span>, <span class="variable">$subject</span>, <span class="variable">$body</span>, <span class="variable">$altBody</span>);</pre>
            </div>

            <!-- Example 3: Email with Attachments -->
            <div class="example">
                <h3>3Ô∏è‚É£ Sending Email with Attachments</h3>
                <p>Send an email with one or more file attachments:</p>
                <pre><span class="keyword">require_once</span> <span class="string">'{{ phpmailer_install_dir }}/mailer_config.php'</span>;

<span class="variable">$to</span> = <span class="string">'recipient@example.com'</span>;
<span class="variable">$subject</span> = <span class="string">'Invoice for Your Order'</span>;
<span class="variable">$body</span> = <span class="string">'<h2>Invoice Attached</h2><p>Please find your invoice attached.</p>'</span>;

<span class="comment">// Array of file paths to attach</span>
<span class="variable">$attachments</span> = [
    <span class="string">'/path/to/invoice.pdf'</span>,
    <span class="string">'/path/to/receipt.pdf'</span>
];

<span class="keyword">if</span> (<span class="function">sendEmailWithAttachments</span>(<span class="variable">$to</span>, <span class="variable">$subject</span>, <span class="variable">$body</span>, <span class="variable">$attachments</span>)) {
    <span class="keyword">echo</span> <span class="string">"Email with attachments sent!"</span>;
}</pre>
            </div>

            <!-- Example 4: Advanced Usage -->
            <div class="example">
                <h3>4Ô∏è‚É£ Advanced Usage - Direct PHPMailer Object</h3>
                <p>For more control, use the PHPMailer object directly:</p>
                <pre><span class="keyword">require_once</span> <span class="string">'{{ phpmailer_install_dir }}/mailer_config.php'</span>;

<span class="keyword">try</span> {
    <span class="comment">// Get configured mailer instance</span>
    <span class="variable">$mail</span> = <span class="function">getMailer</span>();
    
    <span class="comment">// Recipients</span>
    <span class="variable">$mail</span>-><span class="function">addAddress</span>(<span class="string">'recipient@example.com'</span>, <span class="string">'John Doe'</span>);
    <span class="variable">$mail</span>-><span class="function">addCC</span>(<span class="string">'cc@example.com'</span>);
    <span class="variable">$mail</span>-><span class="function">addBCC</span>(<span class="string">'bcc@example.com'</span>);
    
    <span class="comment">// Reply-To address</span>
    <span class="variable">$mail</span>-><span class="function">addReplyTo</span>(<span class="string">'noreply@example.com'</span>, <span class="string">'No Reply'</span>);
    
    <span class="comment">// Content</span>
    <span class="variable">$mail</span>->Subject = <span class="string">'Advanced Email Example'</span>;
    <span class="variable">$mail</span>->Body    = <span class="string">'<h1>This is the HTML body</h1>'</span>;
    <span class="variable">$mail</span>->AltBody = <span class="string">'This is the plain text version'</span>;
    
    <span class="comment">// Attachments</span>
    <span class="variable">$mail</span>-><span class="function">addAttachment</span>(<span class="string">'/path/to/file.pdf'</span>);
    <span class="variable">$mail</span>-><span class="function">addAttachment</span>(<span class="string">'/path/to/image.jpg'</span>, <span class="string">'custom-name.jpg'</span>);
    
    <span class="comment">// Embedded images</span>
    <span class="variable">$mail</span>-><span class="function">addEmbeddedImage</span>(<span class="string">'/path/to/logo.png'</span>, <span class="string">'logo_cid'</span>);
    <span class="variable">$mail</span>->Body = <span class="string">'<img src="cid:logo_cid">'</span>;
    
    <span class="comment">// Send</span>
    <span class="variable">$mail</span>-><span class="function">send</span>();
    <span class="keyword">echo</span> <span class="string">"Email sent successfully!"</span>;
    
} <span class="keyword">catch</span> (Exception <span class="variable">$e</span>) {
    <span class="keyword">echo</span> <span class="string">"Error: "</span> . <span class="variable">$mail</span>->ErrorInfo;
}</pre>
            </div>

            <!-- Example 5: Multiple Recipients -->
            <div class="example">
                <h3>5Ô∏è‚É£ Sending to Multiple Recipients</h3>
                <p>Send the same email to multiple recipients:</p>
                <pre><span class="keyword">require_once</span> <span class="string">'{{ phpmailer_install_dir }}/mailer_config.php'</span>;

<span class="variable">$recipients</span> = [
    <span class="string">'user1@example.com'</span>,
    <span class="string">'user2@example.com'</span>,
    <span class="string">'user3@example.com'</span>
];

<span class="variable">$subject</span> = <span class="string">'Newsletter - December 2024'</span>;
<span class="variable">$body</span> = <span class="string">'<h2>Monthly Newsletter</h2><p>Here are this month\'s updates...</p>'</span>;

<span class="keyword">foreach</span> (<span class="variable">$recipients</span> <span class="keyword">as</span> <span class="variable">$recipient</span>) {
    <span class="keyword">if</span> (<span class="function">sendEmail</span>(<span class="variable">$recipient</span>, <span class="variable">$subject</span>, <span class="variable">$body</span>)) {
        <span class="keyword">echo</span> <span class="string">"Sent to: "</span> . <span class="variable">$recipient</span> . <span class="string">"<br>"</span>;
    }
    <span class="comment">// Add small delay to avoid rate limiting</span>
    <span class="function">sleep</span>(1);
}</pre>
            </div>

            <!-- Example 6: Error Handling -->
            <div class="example">
                <h3>6Ô∏è‚É£ Proper Error Handling</h3>
                <p>Always implement proper error handling:</p>
                <pre><span class="keyword">require_once</span> <span class="string">'{{ phpmailer_install_dir }}/mailer_config.php'</span>;

<span class="keyword">try</span> {
    <span class="variable">$mail</span> = <span class="function">getMailer</span>();
    <span class="variable">$mail</span>-><span class="function">addAddress</span>(<span class="string">'recipient@example.com'</span>);
    <span class="variable">$mail</span>->Subject = <span class="string">'Test Email'</span>;
    <span class="variable">$mail</span>->Body = <span class="string">'Test message'</span>;
    
    <span class="keyword">if</span> (!<span class="variable">$mail</span>-><span class="function">send</span>()) {
        <span class="comment">// Log the error</span>
        <span class="function">error_log</span>(<span class="string">"Email Error: "</span> . <span class="variable">$mail</span>->ErrorInfo);
        
        <span class="comment">// Show user-friendly message</span>
        <span class="keyword">echo</span> <span class="string">"Sorry, we couldn't send the email. Please try again later."</span>;
    } <span class="keyword">else</span> {
        <span class="keyword">echo</span> <span class="string">"Email sent successfully!"</span>;
    }
    
} <span class="keyword">catch</span> (Exception <span class="variable">$e</span>) {
    <span class="comment">// Log the exception</span>
    <span class="function">error_log</span>(<span class="string">"Email Exception: "</span> . <span class="variable">$e</span>-><span class="function">getMessage</span>());
    
    <span class="comment">// Show user-friendly message</span>
    <span class="keyword">echo</span> <span class="string">"An error occurred. Please contact support."</span>;
}</pre>
            </div>

            <div class="info-box">
                <h4>üìù Important Notes</h4>
                <ul>
                    <li><strong>Rate Limiting:</strong> Azure Communication Services has rate limits. Add delays between bulk emails.</li>
                    <li><strong>Sender Verification:</strong> Ensure your sender email is verified in Azure Communication Services.</li>
                    <li><strong>Logging:</strong> Check logs at <span class="code-inline">{{ mail_log_path }}</span> for debugging.</li>
                    <li><strong>Security:</strong> Never expose credentials in client-side code or public repositories.</li>
                    <li><strong>Testing:</strong> Always test emails in a development environment first.</li>
                    <li><strong>Plain Text:</strong> Always provide an AltBody for email clients that don't support HTML.</li>
                </ul>
            </div>

            <div class="info-box">
                <h4>üîß Configuration Constants Available</h4>
                <ul>
                    <li><span class="code-inline">AZURE_SMTP_HOST</span> - SMTP server hostname</li>
                    <li><span class="code-inline">AZURE_SMTP_PORT</span> - SMTP port (587 or 465)</li>
                    <li><span class="code-inline">AZURE_SMTP_USERNAME</span> - SMTP username</li>
                    <li><span class="code-inline">AZURE_SMTP_PASSWORD</span> - SMTP password</li>
                    <li><span class="code-inline">AZURE_SMTP_ENCRYPTION</span> - Encryption type (tls/ssl)</li>
                    <li><span class="code-inline">MAIL_FROM_ADDRESS</span> - Default sender email</li>
                    <li><span class="code-inline">MAIL_FROM_NAME</span> - Default sender name</li>
                    <li><span class="code-inline">MAIL_LOG_PATH</span> - Log directory path</li>
                </ul>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <a href="/" class="btn">‚Üê Back to Home</a>
                <a href="/test_email.php" class="btn">Test Email Sending ‚Üí</a>
            </div>
        </div>
        
        <div class="footer">
            <p><strong>PHPMailer with Azure Communication Services</strong></p>
            <p style="margin-top: 10px;">Configuration: <span class="code-inline">{{ phpmailer_install_dir }}/mailer_config.php</span></p>
            <p style="margin-top: 5px; font-size: 0.9em;">For more information, visit <a href="https://github.com/PHPMailer/PHPMailer" target="_blank">PHPMailer Documentation</a></p>
        </div>
    </div>
</body>
</html>
